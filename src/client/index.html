<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<meta http-equiv="X-UA-Compatible" content="ie=edge" />
	<title>Document</title>
	<script src="https://cdn.socket.io/3.1.3/socket.io.min.js"
		integrity="sha384-cPwlPLvBTa3sKAgddT6krw0cJat7egBga3DJepJyrLl4Q9/5WLra3rrnMcyTyOnh"
		crossorigin="anonymous"></script>
</head>

<body  onload="startGame()">
	<div style="text-align:center;width:480px;">
		<button onmousedown="moveup()" onmouseup="clearmove()" ontouchstart="moveup()">UP</button><br><br>
		<button onmousedown="moveleft()" onmouseup="clearmove()" ontouchstart="moveleft()">LEFT</button>
		<button onmousedown="moveright()" onmouseup="clearmove()" ontouchstart="moveright()">RIGHT</button><br><br>
		<button onmousedown="movedown()" onmouseup="clearmove()" ontouchstart="movedown()">DOWN</button>
	</div>
	<a href="https://fontmeme.com/pac-man-font/"><img
			src="https://fontmeme.com/permalink/210520/d3d19ccb10786c8942b87a9f0f03e0c2.png" alt="pac-man-font"
			border="0"></a>
	<br>
	<br>
	<span id="joinCode"></span>
	<span class="name">Name : </span>
	<input class="nameInput" type="text">
	<button class="createButton" style="display:block" onClick="createRoom()">Create room</button>
	<button class="JoinButton" style="display:block" onClick="joinRoom()">Join room</button>
	<span class="joinText" style="display:none">Room code</span>
	<input class="joinInput" type="text" style="display:none">
	<button class="join" style="display:none" onClick="joinRoomSelect()">Join</button>
	<br>
	<span class="userRoom" style="display:none">User in room :</span>
	<br>
	<span id="test"></span>

</body>

<script>
	const socket = io("http://localhost:3000");

	socket.on('user', (user) => {
		console.log(user)
		document.getElementById("test").innerHTML = `User 1 : ${user.user1} <br> User 2 : ${user.user2}`;

	})

	function createRoom() {
		document.getElementsByClassName('createButton')[0].style.display = 'none';
		document.getElementsByClassName('JoinButton')[0].style.display = 'none';
		document.getElementsByClassName('name')[0].style.display = 'none';
		document.getElementsByClassName('nameInput')[0].style.display = 'none';
		document.getElementsByClassName('userRoom')[0].style.display = 'block';
		let room = getRandomString(6);
		let name = document.getElementsByClassName("nameInput")[0].value
		document.getElementById("joinCode").textContent = `Code to join the game : ${room}`;
		socket.emit("createRoom", room, name);
	}

	function joinRoom() {
		document.getElementsByClassName('createButton')[0].style.display = 'none';
		document.getElementsByClassName('name')[0].style.display = 'none';
		document.getElementsByClassName('nameInput')[0].style.display = 'none';
		document.getElementsByClassName('JoinButton')[0].style.display = 'none';
		document.getElementsByClassName('joinInput')[0].style.display = 'block';
		document.getElementsByClassName('join')[0].style.display = 'block';
		document.getElementsByClassName('joinText')[0].style.display = 'block';
		document.getElementsByClassName('userRoom')[0].style.display = 'block';
	}

	function joinRoomSelect() {
		let room = document.getElementsByClassName("joinInput")[0].value
		let name = document.getElementsByClassName("nameInput")[0].value
		document.getElementsByClassName('joinInput')[0].style.display = 'none';
		document.getElementsByClassName('join')[0].style.display = 'none';
		document.getElementsByClassName('joinText')[0].style.display = 'none';

		socket.emit("joinRoom", room, name)
	}

	function getRandomString(length) {
		var randomChars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
		var result = '';
		for (var i = 0; i < length; i++) {
			result += randomChars.charAt(Math.floor(Math.random() * randomChars.length));
		}
		return result;
	}
</script>
<script>

	var myGamePiece;

	function startGame() {
		myGamePiece = new component(30, 30, "https://www.w3schools.com/graphics/smiley.gif", 10, 120, "image");
		myGameArea.start();
	}

	var myGameArea = {
		canvas: document.createElement("canvas"),
		start: function () {
			this.canvas.width = 480;
			this.canvas.height = 270;
			this.context = this.canvas.getContext("2d");
			document.body.insertBefore(this.canvas, document.body.childNodes[0]);
			this.frameNo = 0;
			this.interval = setInterval(updateGameArea, 20);
		},
		clear: function () {
			this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
		},
		stop: function () {
			clearInterval(this.interval);
		}
	}

	function component(width, height, color, x, y, type) {
		this.type = type;
		if (type == "image") {
			this.image = new Image();
			this.image.src = color;
		}
		this.width = width;
		this.height = height;
		this.speedX = 0;
		this.speedY = 0;
		this.x = x;
		this.y = y;
		this.update = function () {
			ctx = myGameArea.context;
			if (type == "image") {
				ctx.drawImage(this.image,
					this.x,
					this.y,
					this.width, this.height);
			} else {
				ctx.fillStyle = color;
				ctx.fillRect(this.x, this.y, this.width, this.height);
			}
		}
		this.newPos = function () {
			this.x += this.speedX;
			this.y += this.speedY;
		}
	}

	function updateGameArea() {
		myGameArea.clear();
		myGamePiece.newPos();
		myGamePiece.update();
	}

	function moveup() {
		myGamePiece.speedY = -1;
	}

	function movedown() {
		myGamePiece.speedY = 1;
	}

	function moveleft() {
		myGamePiece.speedX = -1;
	}

	function moveright() {
		myGamePiece.speedX = 1;
	}

	function clearmove() {
		myGamePiece.speedX = 0;
		myGamePiece.speedY = 0;
	}
</script>

</html>